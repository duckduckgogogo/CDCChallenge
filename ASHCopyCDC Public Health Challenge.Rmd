---
title: "CDC Public Health Challenge"
author: "Ashira Mawji, Alison Ortiz Damas, Clara Seo"
date: "11/10/2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}

# Load packages
library(mosaic)  
library(tidyverse)
library(usmap)
library(readxl)

knitr::opts_chunk$set(echo = TRUE)
require(knitr) # knitr settings to control how R chunks work.
knitr::opts_chunk$set(
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code

# Import Opioid Data
opioidsCDC <- read_xlsx("~/Documents/CDCChallenge/OPIOID FINAL DATA.xlsx")
str(opioidsCDC)
```

## Map of United States

```{r}
opioidsCDC <- rename(opioidsCDC, state=State)

opioidsCDC <- opioidsCDC %>% 
  mutate(sqrtDeathRate=sqrt(DeathRate)) %>% 
  mutate(VeteranPercent=(VeteranPopu/StatePopu)*100)

plot_usmap(data = opioidsCDC, values = "sqrtDeathRate", lines = "black") + 
  scale_fill_continuous(name = "Sqrt of OD Death Rates \nper 100,000 (2016)", label = scales::comma, high = "#3182bd", low = "#deebf7") + 
  theme(legend.position = "right")

plot_usmap(data = opioidsCDC, values = "VeteranPercent", lines = "black") + 
  scale_fill_continuous(name = "Percentage of Veterans \nby State (2016)", label = scales::comma, high = "#3182bd", low = "#deebf7") + 
  theme(legend.position = "right")
```

## Linear Plot

You can also embed plots, for example:

```{r pressure, echo=FALSE}
cor(RxRate ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# 0.09874413
cor(RxNo ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# -0.01618705
cor(HeroinRate ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# 0.1331886
cor(SyntheticRate ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# 0.09112659
cor(OpioidRxRate ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# 0.06358407
cor(MeanElevation ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# -0.2637968
cor(MinWage ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# -0.08391214
cor(DemParty/(DemParty+RepParty) ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# 0.1792301
cor(RepParty/(DemParty+RepParty) ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# -0.1792301
cor(VetsNo ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# -0.08040018
cor(VeteranPopu ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# -0.07493056
cor(VeteranUnemp ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# 0.1696929
cor(VeteranPoverty ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# -0.0451603
cor(VeteranDisability ~ DeathRate, data = opioidsCDC, use = "pairwise.complete.obs")
# 0.09417756


ggplot(opioidsCDC, aes(x=DeathRate, y=DemParty/(DemParty+RepParty), col=factor(Region))) +
  xlab("Overdose Death Rates per 100,000") +
  ylab("Proportion of Democratic Representatives") + 
  geom_point() +
  scale_color_discrete(name="Democratic Rep Ratio \nby Region", 
                      breaks=c(1, 2, 3, 4), 
                      labels=c("Northeast", "Midwest", "South", "West"))

ggplot(opioidsCDC, aes(x=DeathRate, y=RepParty/(DemParty+RepParty), col=factor(Region))) +
  ggtitle("") +
  xlab("Overdose Death Rates per 100,000") +
  ylab("Proportion of Republican Representatives") + 
  geom_point() +
  scale_color_discrete(name="Republican Rep Ratio \nby Region", 
                      breaks=c(1, 2, 3, 4), 
                      labels=c("Northeast", "Midwest", "South", "West"))

ggplot(opioidsCDC, aes(x=HighElevation, y=DeathRate)) +
  ggtitle("") +
  ylab("Overdose Death Rates per 100,000") +
  xlab("Highest Elevation by State (feet)") + 
  geom_point()

ggplot(opioidsCDC, aes(x=MeanElevation, y=DeathRate)) +
  ggtitle("") +
  ylab("Overdose Death Rates per 100,000") +
  xlab("Mean Elevation by State (feet)") + 
  geom_point()

ggplot(opioidsCDC, aes(x=MinWage, y=DeathRate)) +
  ggtitle("") +
  ylab("Overdose Death Rates per 100,000") +
  xlab("Minimum Wage by State ($)") + 
  geom_point()

ggplot(opioidsCDC, aes(x=VeteranDisability, y=DeathRate)) +
  ylab("Overdose Death Rates per 100,000") +
  xlab("Disability Rate of Veterans by State") + 
  geom_point()

ggplot()

opioids2 <- mutate(opioidsCDC, VetsPercent=(VetsNo/StatePopu)*100)
opioids2 <- select(opioidsCDC, -c(state,StateAbr,FentanylRate))

#mutated graphs: 

#DeathRate, HeroinRate, SyntheticRate -- MeanElevation
opioids2 <- mutate (opioidsCDC, MeanElevation.sqrt = sqrt(MeanElevation))
opioids2 <- mutate (opioidsCDC, MeanElevation.sq = MeanElevation^2)
opioids2 <- mutate (opioidsCDC, MeanElevation.log = log(MeanElevation))
opioids2 <- mutate (opioidsCDC, MeanElevation.sq = MeanElevation^2)
opioids2 <- mutate (opioidsCDC, MeanElevation.sq = MeanElevation^2)
pairs(opioids2[c("DeathRate", "MeanElevation", "MeanElevation.sqrt")])

#DeathRate, HeroinRate, SyntheticRate -- MinWage

#DeathRate, HeroinRate, SyntheticRate -- VetsNo

#DeathRate, HeroinRate, SyntheticRate -- RxRate, OpioidRxRate

#DeathRate, HeroinRate, SyntheticRate -- VeteranUnemp, VeteranPoverty, VeteranDisability

#RxRate, OpioidRxRate -- VeteranUnemp, VeteranPoverty, VeteranDisability

pairs(opioids2[c("DeathRate", "RxRate", "HeroinRate", "SyntheticRate", "OpioidRxRate")])
pairs(opioids2[c("DeathRate", "MeanElevation", "MinWage", "VetsNo")])
pairs(opioids2[c("DeathRate", "VeteranUnemp", "VeteranPoverty", "VeteranDisability")])
pairs(opioids2[c("DeathRate", "RxRate", "HeroinRate", "SyntheticRate", "OpioidRxRate", "MeanElevation", "MinWage", "VetsNo", "VeteranUnemp", "VeteranPoverty", "VeteranDisability")])
#pairs(opioids2[c("DeathRate", "DemParty/(DemParty+RepParty)", "RepParty/(DemParty+RepParty)", "MinWage", "VetsNo")])
```